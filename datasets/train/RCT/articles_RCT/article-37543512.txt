Integrating metabolic expenditure information from wearable fitness sensors into 
an AI-augmented automated insulin delivery system: a randomised clinical trial.

Introduction
Type 1 diabetes (type 1 diabetes) is an autoimmune disorder that results in the destruction of the insulin-producing β cells in the pancreas. People with type 1 diabetes cannot produce sufficient insulin to maintain normal glucose concentrations and therefore must take exogenous insulin through either injection or an insulin pump. Automated insulin delivery (AID) systems are now commercially available and comprise a continuous glucose monitor (CGM), an insulin pump, and a control algorithm to automate insulin delivery based on sensed glucose.1–4 Commercial systems are hybrid systems requiring the person to estimate the amount of carbohydrates in their meals and enter this information into the AID to calculate meal insulin. Newer systems under development are fully automated and do not require carbohydrate entry.5 Although commercial AIDs have shown benefit, there is still need for improvement as many people on AID do not yet achieve the target of HbA1c below 7·0% and hypoglycaemia can occur, especially during times of high physical activity.6

A remaining challenge in glucose management for people with type 1 diabetes is maintaining optimal glucose concentration during and following exercise to avoid hypoglycaemia.7,8 Glucose management during exercise is particularly challenging for people with type 1 diabetes because the glucose response depends on many factors including type of exercise, duration, intensity, amount of insulin acting at the time of exercise, time of day, and whether exercise is competitive. Aerobic exercise is particularly problematic as it can cause sharp drops in glucose, especially when performed shortly after a meal when insulin concentrations are high.9 Compounding the problem is that there is substantial variation in glucose response during exercise, even when the exercise is done by the same person across similar days when all conditions of eating, insulin dosing, and exercise are consistent.10 Consensus statements provide guidelines to people with type 1 diabetes to help them adjust insulin and carbohydrate intake before and during exercise if necessary.7,8 Some commercial AIDs offer the ability to change the glucose target before and during exercise, which can be helpful in avoiding hypoglycaemia during exercise.11 However, adjustment of the target is not automatic and requires the person to change the target, typically several hours in advance of exercise. Herein, we present results from a clinical study showing how an AID system can respond automatically to exercise quantified using a wrist-worn fitness watch.

Automating the detection of exercise using wearable sensors is now possible because of the ubiquity of commercial wearable sensors that quantify physical activity measures including heart rate and accelerometry. These sensors can be leveraged to compute various derived metrics including metabolic equivalent to task (MET), exercise start and stop, duration, intensity, and exercise type. Research has been done to assess the accuracy of these metrics12 which is critical for their potential use within AIDs that can then automatically adjust dosing in response to exercise.

Once physical activity has been quantified, it needs to be properly used within a control algorithm to adjust insulin dosing. Turksoy and colleagues13 showed in a small in-clinic trial that various physical activity metrics including energy expenditure and galvanic skin impedance from a SenseWear Pro 3 (Pittsburgh, PA, USA) could be used to inform an AID. Participants in their 60 h in-clinic study performed a variety of exercises while using this multiple-input AID. Participants maintained a time in range of 69·9% with low time in hypoglycaemia, although 16 (59%) of 27 aerobic exercise sessions required participants to consume carbohydrates during exercise sessions to avoid low glucose. De Boer and Breton also showed, in an in-clinic study, that using heart rate as an additional input to an AID could significantly reduce the percent time in low glucose (<3·9 mmol/L) during exercise compared with an AID that did not use heart rate.14 Garcia-Tirado and colleagues described an AID that anticipated exercise from past behavioural patterns to estimate exercise in the future that could occur at the same time, showing in an in-clinic study that the number of low glucose events could be reduced when the AID anticipates exercise.15 Our group has used exercise metrics from wearable sensors to inform an exercise-aware multihormone (insulin and glucagon) adaptive proportional derivative (exAPD) closed-loop control algorithm.16 This algorithm was used to reduce insulin and increase glucagon in response to the exercise onset. Clinical studies showed that use of this exAPD algorithm when used in dual-hormone mode (insulin and glucagon) could help reduce hypoglycaemia substantially compared with when it was used in single-hormone mode.17 The exAPD algorithm detected when METs exceeded a threshold of 4·0 then prompted the user to confirm exercise. After user confirmation, the exAPD would shut off insulin for 30 min, and then reduce insulin delivery by 50% over the next 60 min. While the exAPD algorithm described above is helpful in reducing insulin during and following exercise, it required the user to interact with the system by responding to a prompt and confirming exercise. The exAPD algorithm was unable to respond automatically to physical activity that is not typically considered exercise, such as housework, yardwork, commuting by bike or walking, etc, because the intensity and duration thresholds of such activities might be lower than the intensity threshold for exercise detection used in exAPD.

The normal functioning pancreas responds continuously to physical activity by reducing insulin secretion when physical activity increases to avoid hypoglycaemia. Herein, we describe an exercise-aware model predictive control algorithm (exMPC) that behaves more like the human pancreas by responding in real-time to increases or decreases in physical activity to modulate the amount of insulin delivered. The algorithm has been described in earlier publications18,19 and a brief overview is in the appendix (pp 2–7).

Methods
Study design and participants
This study was a randomised, single-centre crossover study.

Participants were enrolled from the Harold Schnitzer Diabetes Health Center clinic at Oregon Health and Science University (OHSU). Inclusion criteria required diagnosis with type 1 diabetes for at least 1 year, age of 21–50 years, physically willing and able to perform aerobic exercise, current use of an insulin pump for at least 3 months with stable insulin pump settings for at least 2 weeks, living with a person aged 18 years or older, living within 40 miles of OHSU, baseline HbA1c of 10·0% or lower, and a total daily insulin requirement of less than 139 units per day, chosen to ensure that expected meal insulin could be fully delivered within 20 min. Exclusion criteria included females of childbearing age who were pregnant or intending to become pregnant, cardiovascular disease, renal insufficiency, liver failure, low haematocrit concentration, uncon trolled hyper tension, history of severe hypoglycaemia during past year, history of ketoacidosis during preceding 6 months, adrenal insufficiency, and active infection.

The first visit to the clinic was a screening visit that was within 12 weeks before the 1 week run-in period; participants were consented via written informed consent, screened for eligibility, and HbA1c was measured along with an EKG. After eligibility was confirmed, participants performed a 1 week run-in when they received training on using the Dexcom G6 CGM (Dexcom, San Diego, CA, USA). Following the 1 week run-in, participants arrived at the OHSU inpatient research unit to start the first 76 h treatment.

Complete protocol (Institutional Review Board protocol number 19973 and investigational device exemption (G200363) is provided in the appendix (p 7).

Procedures
Since the exMPC algorithm was a new algorithm that had not been previously tested in humans, for safety reasons and as requested by the US Food and Drug Administration (FDA), the first eight participants used the exMPC only during the 12 h daytime period (0700–1900 h) in the clinic on days 1–3. During the evening hours, these participants used the iPancreas system in open loop only. After safety was confirmed for the first eight participants using exMPC, the remaining partici pants used exMPC during days 2 and 3 under freeliving conditions. The primary in-clinic session was on day 3 for these first eight exMPC studies, and day 1 for the remaining exMPC studies and for all of the exAPD studies.

During the primary in-clinic session of the study, participants ate self-selected meals at approximately 0800 h, 1200 h, and 1700 h. Participants counted their own carbohydrates and entered these into the AID system using the iPancreas app; identical meals were consumed for the exMPC arm and the exAPD arms during the primary in-clinic session of the study. During the primary in-clinic session, participants performed activities of daily living at 1000 h that included vacuuming, washing dishes, folding laundry, etc, and performed a 30 min aerobic exercise video at 1500 h referred to herein as structured exercise. The exercise video included a 3 min warm-up and cool-down and workout designed to elicit a target heart rate of 70–80% of the age-predicted maximal heart rate. The hypothesis was that exMPC would lead to less percent time below range (time below range <3·9 mmol/L) than exAPD during the primary in-clinic session because exMPC was always using physical activity data to adjust the insulin and therefore responding to all activity during the day, not just structured exercise. Conversely, exAPD only adjusted insulin in response to structured exercise, but not throughout the day or during the activities of daily living. The exAPD also required the participant to respond to a prompt when physical activity exceeded 4·0 METs whereas the exMPC algorithm did not require any interactions from the participant in response to physical activity changes.

Participants were discharged from the clinic at approximately 2000 h. For days 2 and 3 of the interventional part of the study, participants used iPancreas at home under free-living conditions and were instructed to exercise on their own. On day 4 of the intervention, participants returned to the clinic to end the first arm of the study. After the first treatment visit, a washout period of 6 days to 10 weeks was done before performing the next 76 h intervention on either the exMPC or exAPD depending on the first intervention arm.

Outcomes
The primary outcome measure was the percent time below range during the 12 h primary in-clinic session. Primary and secondary outcome measures were also assessed during the entire 76 h study and also during the 2 h period immediately after the start of structured exercise on the primary in-clinic session. Glucose metrics were based on Dexcom G6 CGM data. Secondary outcome measures included the percent time in range (3·9–10 mmol/L), percent time above range (>10 mmol/L), total number of rescue carbohydrates required per day in response to hypoglycaemia (<3·9 mmol/L), mean glucose, percent time glucose was very low (<3·0 mmol/L), percent time sensed glucose was very high (>13·9 mmol/L) and mean amount of insulin per day.

Randomisation and masking
Participants were randomised using block randomisation with a block size of 4 to first use iPancreas running either exMPC or exAPD for the duration of the intervention. The study was non-blinded in that the study participants and the investigators knew the intervention that was being done.

Overview of iPancreas test platform
iPancreas (appendix p 41) is a modular, licensable, open access system to enable rapid prototyping of closed-loop and decision support algorithms and user interfaces for glucose management. The system (figure 1) comprises the custom iPancreas app running on a Samsung smartphone (Suwon-Si, Korea), a Dexcom G6 CGM, a research version Insulet Omnipod (Acton, MA, USA), a Polar M600 smartwatch (Kempele, Finland), and a custom-developed cloud monitoring and data acquisition repository running on Amazon Web Services (Seattle, WA, USA). CGM data and M600 heart rate and accelerometry data are received wirelessly by the phone. The control algorithm calculates the amount of insulin to deliver and sends this information wirelessly to the Omnipod. iPancreas includes a simple meal bolus calculator.
Overview of the AID algorithms
The exMPC algorithm18–21 (appendix p 2) is a traditional MPC algorithm that uses a linearised version of a compartment model comprising nonlinear differential equations that represent kinetics and dynamics of subcutaneously delivered insulin, carbohydrates, and exercise. The insulin kinetics and dynamics models and the carbohydrate absorption model are described by Hovorka and colleagues22 and Wilinska and colleagues.23 The exercise model is described by Hernandez and colleagues24 and describes how glucose uptake and endogenous glucose production are impacted by METs. We calculated METs using accelerometer and heart rate data (appendix p 6). The METs data is provided as an input to the control algorithm every 5 min when a new insulin delivery micro-bolus is calculated.

The exAPD algorithm17,20,21 is a proportional-derivative control algorithm that includes a fading history of past CGM to calculate the amount of insulin that should be delivered every 5 min.25 Because the exAPD algorithm does not include a model of metabolism, exercise metrics such as heart rate and accelerometry cannot be easily included as a continuous input. Instead, the exAPD algorithm calculates METs (appendix p 6), and if METs exceeds a threshold of 4·0, then the person using iPancreas will be prompted to confirm exercise. After accepting the prompt, insulin is turned off for 30 min and then reduced by 50% for 1 h.

Artificial intelligence (AI)-augmented safety layer
Both exAPD and exMPC use a safety layer built into iPancreas. This includes an AI-based predictive low glucose suspend algorithm that uses a long-short-term memory (LSTM) neural network26 glucose forecasting algorithm to automatically shut off insulin if CGM is 3·9–7·77 mmol/L and predicted to drop below 5 mmol/L within 30 min (appendix p 5–6). In addition, the maximum insulin delivery rate is limited to four times the user’s typical basal insulin infusion rate. Finally, maximum insulin delivery is limited such that insulin on board never exceeds 35% of the total daily insulin requirement.

Statistical analysis
For the primary outcome of percent time with glucose less than 3·9 mmol/L, we anticipated a mean paired difference of 1·2 (SD 2·5) with a kurtotic, double-exponential distribution, based on previously published, closed-loop study data20 and simulations using the OHSU simulator.27 A sample of 24 participants provided 80% power at the 0∙05 level of significance to detect a difference of that size or larger using a two-sided t test with an adjustment for the distribution. For normally distributed secondary outcomes, we had over 80% power to detect differences of 0·6 SD or greater using a two-sided one-sample t test for the mean difference at the 0∙05 significance level. Power calculations were done using Power Analysis and Sample Size Software (version 14; NCSS, Kaysville, UT, USA).

The primary study endpoint was percent of time with CGM below range (time below range, <3·9 mmol/L) during the primary in-clinic session. The hypothesis to be tested was whether the exMPC decreases time below range compared with the exAPD algorithm. For this, as well as for secondary endpoints, we used an intention-to-treat analysis whereby all available data were included if the participant completed the primary in-clinic session. Mean paired differences were calculated as the differences between the two sample means with SD of the differences

SDdiff=SD2exMPC+SD2exAPD−(2×CorrexMPC_exAPD×SDexMPC×SDexAPD)−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−√
where CorrexMPC_exADP is the sample correlation between measurements in the two arms. Two-sided p values were calculated using a panel model for each endpoint with a random intercept for participant and indicator variables for the intervention, the sequence of the intervention (exMPC first or second, as a measure of potential carryover effects), and period (first or second). For the primary endpoint, which had non-normally distributed residuals, the standard errors for this model were calculated using bootstrap methods where participants were resampled with 1000 replications. For endpoints that were counts, we used negative binomial models. Other non-normally distributed outcomes were transformed or bootstrapped, depending on the fit of the transformation. Analyses were completed using Matlab (Mathworks, Natick MA; version 21b) and Stata/IC (Stata Statistical Software, College Station TX; version 16.1).

This trial is registered with ClinicalTrials.gov, NCT04771403.

Role of the funding source
Funders did not have a role in the study design, data collection, interpretation of results, or the writing of the manuscript.


Results
Between April 13, 2021, and Oct 3, 2022, 27 adults (18 females) with type 1 diabetes from the Harold Schnitzer Diabetes Health Center clinic at OHSU were recruited into the study (table 1). Of the 27 participants screened, 25 (16 females) participated in the study (figure 2). 24 of 25 participants completed the exMPC arm and 22 of 25 participants completed the exAPD arm (figure 2). Reasons for not completing an arm included a software error that occurred and was fixed early on in the study (n=2), pump occlusion (n=1), and a participant withdrew from the study before starting the arm (n=1). There were no serious adverse events. The washout period was not correlated with time below range or time in range.
Both exMPC and exAPD were similarly effective at using exercise data to prevent low glucose. For the primary outcome measure, participants using exMPC had similar time below range compared with participants using exAPD during the primary in-clinic session (1·3% vs 2·5%, difference −1·2 [SD 7·3]; p=0∙46; table 2). Time in range was similar for participants using the exMPC compared with the exAPD during the primary in-clinic session (63·2% vs 59·4%, difference 3·8 [29·8]; p=0∙49). Table 2 shows that there was no significant effect of the sequence of participants performing exMPC versus exAPD arms first. However, the order of performing the intervention regardless of intervention type as indicated by the column labelled period, was significant for time in range (increased in period 2) and time above range (decreased in period 2), indicating that the participants might have benefited from learning in the first period. Figure 3 shows that the exMPC algorithm tended to respond more to the activities of daily living during the morning time by turning down insulin whereas exAPD did not adjust insulin based on the activities of daily living since it was only designed to respond to prolonged vigorous exercise including the structured, user-confirmed exercise video. The automated insulin on board calculated in the 2 h before the start of exercise was comparable for exAPD and exMPC (appendix p 44).
Low glucose (<3·9 mmol/L) occurred during the 2 h after the start of structured exercise during the primary in-clinic session for three participants in each of the exMPC and the exAPD arm. Table 3 shows that the duration of the low glucose during and following structured exercise was similar for exMPC compared with exAPD (1·4% vs 4·9%, difference −3·5 [15·4]; p=0∙29). Participants using exMPC had a significantly lower mean CGM compared with exAPD during this 2 h window after structured exercise in the primary in-clinic session (7·3 vs 8·0 mmol/L, difference −0·8 [1·4]; p=0∙023) and had similar time in very low glucose (0 for exMPC vs 0·57% for exAPD). One participant in the exAPD arm had a very low glucose (<3·0 mmol/L) in the 2 h after the start of structured exercise whereas none of the participants experienced this in the exMPC arm. Participants using the exMPC had better glucose outcomes following in-clinic structured exercise as indicated by a significantly lower mean glucose (figure 4). Figure 4 also shows that although the exAPD shut off insulin completely when structured exercise was detected by the algorithm and accepted by the user prompt, the exMPC algorithm did not completely shut off insulin for all participants as the exercise data were just one input to the algorithm, and in certain cases, a complete shut-off of insulin was not necessarily indicated to maintain optimal glucose outcomes. Insulin shut-off could have been caused by either the LSTM or the exercise detection. The carbohydrate intake before and during exercise was not different between the exMPC and exAPD arms for in-clinic exercise (appendix pp 42–43).
Across the entire 76 h study (table 4), exMPC and exAPD performed comparably in terms of time in range (71·2% vs 75·5%, difference −4·3 [16·4]; p=0∙13) and time below range (0·96% vs 1·30%, difference −0·33 [1·92]; p=0∙47). The use of exMPC over the full study duration required similar rescue carbohydrates compared with exAPD (0·65 for exMPC vs 1·03 per day for exAPD; p=0∙14).
During the free-living exercise sessions at home (appendix pp 42–43), there was no statistically significant difference between the glucose change for exMPC (−21·5 mg/dL [43·8]) versus exAPD (−13·4 mg/dL [27·2]; p=0∙56). CGM at the start and end of exercise was comparable between the in-home exMPC and exAPD exercise sessions. Carbohydrate intake before in-home exercise was higher for exMPC compared with exAPD (7·7 g [8·5] vs 1·0 [3·7]; p=0∙01). No low glucose (<3·9 mmol/L) was observed during the in-home exercise for any participants on either algorithm.

In a post-hoc analysis, we considered the hypothesis that participants using either exMPC or exAPD would have better glucose outcomes compared with their usual care since many participants did not use an AID in their usual care. We compared glucose metrics from the intervention periods with the run-in week when the participants used their own insulin pump and CGM. Notably many participants (n=11) were using commercial AID as their current therapy during run-in. Participants had lower time below range compared with the run-in period (2·4% run-in, p=0∙002 comparing run-in with exMPC of 0·96% and p=0∙019 comparing run-in with exAPD of 1·3%). Time in range was higher for both algorithms compared with run-in but only significant for exAPD (69·2%, p=0∙52 comparing exMPC of 71·2% and p=0∙036 comparing exAPD of 75·5%).


Discussion
Results indicate that the exMPC and exAPD algorithms, that both make use of exercise metrics, yielded comparable glucose outcomes. The exMPC yielded similar time in range and time below range compared with the exAPD during the primary in-clinic session. During the two 2 h after the start of the primary in-clinic session structured exercise period, the exMPC algorithm had better performance than the exAPD in terms of a significantly lower mean glucose without significant concomitant increases in time below range or very low glucose. The exMPC algorithm did not require any interaction from the participant in response to exercise, whereas the exAPD algorithm required the user to respond to the exercise announcement prompts. In this way, exMPC presumably required a lower burden than exAPD.

This is the first study whereby exercise metrics (ie, heart rate and accelerometry) were used as continuous inputs to an AID system to modify insulin dosing under free-living, real-world settings. Previously, the exAPD algorithm was used in both single and dual-hormone closed-loop studies in in-clinic and outpatient free-living conditions. However, the adjustment to the insulin and glucagon dosing was done only after the user responded to a prompt indicating that exercise had been initiated. The exMPC algorithm did not require a user prompt and could respond throughout the day to exercise events. This enabled adjustment of insulin dosing even in response to activities of daily living (figure 3). The inhome results (table 4) indicate that both the exMPC and exAPD performed well and comparably under free-living conditions and on average both were able to keep participants above 70% time in range and less than 4% time below range as recommended by the American Diabetes Association.28 There were no significant differences between the glucose outcomes for the two algorithms during the in-home exercise portions of the study and no low glucose observed during any of the inhome exercise sessions.

Early work on integrating exercise metrics into AID by Turksoy and colleagues13 and De Boer and Breton14 was done within an in-clinic setting. Other work assessed commercial AIDs during exercise. Breton and colleagues evaluated Control-IQ during a ski camp.29 Control-IQ and other commercial AIDs do not use physical activity as an input. They provide the option for adjusting the target glucose before exercise and during exercise to reduce insulin delivery, which can help avoid exercise-induced hypo glycaemia if done in advance.6,11 However, people often forget to make adjustments in advance or make inappropriate adjustments. Furthermore, people might be active throughout the day, but they might not consider any of these activities to be exercise. An AID system like exMPC that can automatically adjust insulin throughout all activities in the day could be helpful to people struggling with glucose management. Glucose has been shown to drop substantially even if basal insulin is suspended at the start of exercise30 and so anticipation of exercise could be critical for future applications.15

Results indicate that use of exercise metrics collected from a commercially available wrist-worn fitness monitor can be used effectively by either exMPC or exAPD as a continuous input in an AID to achieve clinical glucose outcome targets28 for people with type 1 diabetes. Limitations of this study are first that it was a short study. Future studies will evaluate the system over a longer period of time. In addition, the study was powered for 24 participants, but only 22 participants completed the exAPD arm. Furthermore, the SD of the outcome measures was larger in the study than the ones used to power the study. This was probably because a simulator was used to estimate the variance for the power analysis, which can yield smaller variance estimates than real-world data. The small number of participants and the larger variance could partially explain why statistically significant differences might not have been observed in the primary or secondary outcome measures assuming that these differences exist. Second, the performance of the algorithms on primary in-clinic structured exercise sessions was only evaluated on a single type of exercise (aerobic) and was only 30 minutes in duration. However, the system performed well during the free-living portion of the study when participants were instructed to perform exercise on their own on days 2 or 3 of the study. In the future, it will be important to evaluate the exMPC under a variety of exercise types (resistance, aerobic, interval), durations, intensities, and under fasting versus non-fasting states.31 Although the current study was not powered to explore factors contributing to glucose changes, a study by Riddell and colleagues32 provides an analysis on a large cohort of people with type 1 diabetes (n=497) exercising under free-living conditions. They identify baseline glucose, rate of change of glucose before exercise, insulin-on-board at start of exercise and other factors related to changes in glucose during aerobic, resistance, and interval exercise. Third, for safety reasons required by the FDA, we needed to include an in-clinic evaluation period for the exMPC, which potentially introduced noise into the findings because these first eight participants did the exercise on the day 3 in-clinic session. When evaluating the impact of doing the first eight exMPC participants on day 3, we found that these participants had higher time in range and lower time below range than the following 16 participants who did the in-clinic exercise on day 1; the p value did not reach significance (p=0∙063). Future studies will not require this type of a study design. Fourth, the study population from this study was generally well controlled with a mean HbA1c of 6·4%. Future studies will need to evaluate these algorithms in a more broadly representative population. A final limitation is that the results presented here are for only one type of fitness watch, the Polar M600. In a previous study,12 we found that accuracy of different fitness watches including the Garmin and the Fitbit watches, were comparable. If fitness watches are to be used in future closed-loop systems, it will be important to carefully assess the accuracy of heart rate and accelerometer data.

​